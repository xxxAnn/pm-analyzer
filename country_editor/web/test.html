<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Multi-select Dropbox</title>
    <style>
        .country-dropbox {
            position: relative;
            width: 300px;
            border: 1px solid #ccc;
            border-radius: 4px;
            padding: 5px;
            cursor: pointer;
            display: flex;
            align-items: center;
        }

        .country-dropbox::before {
            content: "Apply Template";
            color: #999;
            display: block;
            flex-grow: 1;
        }

        .country-dropbox.active::before {
            content: "";
        }

        .dropdown-list {
            display: none;
            position: absolute;
            top: 100%;
            left: 0;
            width: 100%;
            border: 1px solid #ccc;
            border-radius: 4px;
            background-color: white;
            max-height: 150px;
            overflow-y: auto;
            z-index: 1000;
        }

        .dropdown-list.active {
            display: block;
        }

        .dropdown-list label {
            display: block;
            padding: 5px;
            cursor: pointer;
        }

        .dropdown-list label:hover {
            background-color: #f0f0f0;
        }

        .selected-options {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
        }

        .selected-options span {
            background-color: #e0e0e0;
            border-radius: 4px;
            padding: 2px 5px;
        }
    </style>
</head>
<body>
    <div class="country-dropbox">
        <div class="selected-options"></div>
        <div class="dropdown-list"></div>
    </div>

    <script>
        const countries = [
            "Afghanistan", "Albania", "Algeria", "American Samoa", "Andorra", "Angola"
        ];

        function populateCountryList(countryList) {
            const dropdownList = document.querySelector('.dropdown-list');
            dropdownList.innerHTML = '';

            countryList.forEach(country => {
                const label = document.createElement('label');
                label.innerHTML = `<input type="checkbox" value="${country}"> ${country}`;
                dropdownList.appendChild(label);
            });

            addCheckboxListeners();
        }

        function getSelectedCountries() {
            const selectedCountries = [];
            const checkboxes = document.querySelectorAll('.dropdown-list input:checked');
            checkboxes.forEach(checkbox => {
                selectedCountries.push(checkbox.value);
            });
            return selectedCountries;
        }

        function addCheckboxListeners() {
            const selectedOptions = document.querySelector('.selected-options');
            document.querySelectorAll('.dropdown-list input').forEach(input => {
                input.addEventListener('change', function() {
                    console.log("Hello");

                    selectedOptions.innerHTML = '';
                    const checkedInputs = document.querySelectorAll('.dropdown-list input:checked');
                    const maxSpans = 3;
                    let spanCount = 0;
                    checkedInputs.forEach(checkedInput => {
                        if (spanCount < maxSpans) {
                            const span = document.createElement('span');
                            span.textContent = checkedInput.value;
                            selectedOptions.appendChild(span);
                            spanCount++;
                        }
                    });

                    if (checkedInputs.length > maxSpans) {
                        const span = document.createElement('span');
                        span.textContent = `+ ${checkedInputs.length - maxSpans} others`;
                        selectedOptions.appendChild(span);
                    }

                    const countryDropbox = document.querySelector('.country-dropbox');
                    countryDropbox.classList.toggle('active', checkedInputs.length > 0);
                });
            });
        }

        document.addEventListener('DOMContentLoaded', function() {
            const dropdownList = document.querySelector('.dropdown-list');

            populateCountryList(countries);

            document.querySelector('.country-dropbox').addEventListener('click', function(event) {
                event.stopPropagation();
                dropdownList.classList.toggle('active');
            });

            document.addEventListener('click', function(event) {
                if (!dropdownList.contains(event.target) && !event.target.closest('.country-dropbox')) {
                    dropdownList.classList.remove('active');
                }
            });
        });
    </script>
</body>
</html>
